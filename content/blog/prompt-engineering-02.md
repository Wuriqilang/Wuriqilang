---
external: false
title: 【大模型】 Prompt Engineering 02
description: 2023 年,chatGPT 如春雷乍响,开启了人工智能的新纪元. 我也开启了我的第一课
date: 2023-06-18 00:17:00
---

> 本文主要观点来自 [ChatGPT Prompt Engineering 吴恩达 Prompt](https://learn.deeplearning.ai/)

本文分为上下两篇,上篇:[【大模型】 Prompt Engineering 01](/blog/prompt-engineering-01/)

### 环境配置

我们复用上一章的环境配置和基本代码.担心你懒得点回去,我把环境配置内容再贴一遍

1. 安装 python (推荐使用 anaconda )

2. 安装依赖

```bash
pip install openai
pip install python-dotenv
```

3. 新建一个文件夹,在文件夹里创建 .env 文件,并在其中添加你的 openai API key

```bash
OPENAI_API_KEY='sk-XXXXX'
```

4. 创建一个 python 文件,并在其中添加如下代码

```python
import openai
import os
from dotenv import load_dotenv,find_dotenv

_ = load_dotenv(find_dotenv()) # read local .env file

openai.api_key = os.getenv("OPENAI_API_KEY")

def get_completion(prompt, model = "gpt-3.5-turbo"):
  messages = [{"role":"user","content":prompt}]
  response = openai.ChatCompletion.create(
    model=model,
    messages=messages,
    temperature=0,
  )
  return response.choices[0].message["content"]
```

## 4 文本摘要(Summarizing)

世界上有太多的文本信息，几乎没有人能够拥有足够的时间去。但 LLM 在文本概括任务上展现了强大的水准.

![人生苦短](https://xrtech.oss-cn-shanghai.aliyuncs.com/uPic/2023-06/4AjAsN.jpg)

### 4.1 单文本概括

我们举一个电商的例子,电商平台里有海量的用户评论.
如果我们能够使用 LLM 来对用户的评论进行概括,就可以快速的获得更多信息,洞悉客户偏好.

我从速成美站的评论中随机抽取了一条评论:

```python
review = """
网站改版的时候本来是要找外面的设计公司来做的，后来选择了速成美站，性价比很高！推荐使用标准版的，功能更多一些。但在使用的时候还是遇到了一些问题，主要是对模板后台使用不太熟悉，很多控件不知道如何使用，而且模板没办法直接套用，改动很大，不过在熟悉控件之后，确实和PPT操作差不多了，很意外，搭建成形后的网站感觉还不错，毕竟这是一个小白从头到尾做下来的，真正开始搭建网站只花了不到十天的时间。域名解析和最后的SSL证书部署都是阿里云建站客服人员帮忙解决的，响应速度非常快，而且专业有效率。
"""
```

#### 4.1.1 限制文章长度

````python
# 文本总结
prompt = f"""
你的任务是从电子商务网站上生成一个产品评论的简短摘要。
请对三个反引号之间的评论文本进行概括，

最多30个词汇。

评论: ```{review}```
"""

response = get_completion(prompt)
print(response)

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
#速成美站提供高性价比的标准版，但使用模板后台需要熟悉控件，改动较大。客服响应#快，帮助解决域名和SSL证书问题。
````

#### 4.1.2 侧重不同角度

有时候,对于不同的业务场景,我们需要从不同的角度去概括文本,比如对于这类建站模板产品,商家更加关心产品是否能满足客户需求,客户是否能够快速上手,所以我们可以要求模型从不同的角度去概括文本.

````python
prompt = f"""
你的任务是从电子商务网站上生成一个产品评论的简短摘要。
请对三个反引号之间的评论文本进行概括，

最多30个词汇,并且聚焦在产品易用性上

评论: ```{review}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 使用速成美站标准版易用性高，但模板后台使用需要熟悉，需要改动较大。阿里云建站客服响应速度快，专业有效率。
````

可以看到输出结构把易用性的描述放在了第一位.

再比如侧重产品客服质量:

````python
prompt = f"""
你的任务是从电子商务网站上生成一个产品评论的简短摘要。
请对三个反引号之间的评论文本进行概括，

最多30个词汇,并且聚焦在客服质量上

评论: ```{review}```
"""#

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 使用速成美站搭建网站，遇到模板后台使用问题，但客服响应速度快且专业有效率。
````

#### 4.1.3 关键信息提取

在上一节中我们通过添加侧重角度的 Prompt,是文本总结侧重于某一方面,但仍然保留了其他信息.如果我们只想要某一方面的信息,可以要求 LLM 进行"文本提取(Extract)"而非"文本概括(Summarize)".

````python
# 文本总结
prompt = f"""
你的任务是从电子商务网站上提取相关信息。
请从一下三个反引号之间的评论文本提取客服质量相关的信息，

最多30个词汇

评论: ```{review}```

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 客服响应速度快，专业有效率。
````

### 4.2 多文本概括

在实际的工作流中，我们往往有许许多多的评论文本，以下展示了一个基于 for 循环调用“文本概括”工具并依次打印的示例。

> 当然，在实际生产中，对于上百万甚至上千万的评论文本，使用 for 循环也是不现实的，可能需要考虑整合评论、分布式等方法提升运算效率。

````python

# 一个公仔的评论
review_1 = """
这个熊猫公仔是我给女儿的生日礼物，她很喜欢，去哪都带着。
公仔很软，超级可爱，面部表情也很和善。但是相比于价钱来说，
它有点小，我感觉在别的地方用同样的价钱能买到更大的。
快递比预期提前了一天到货，所以在送给女儿之前，我自己玩了会。
"""

# 一盏落地灯的评论
review_2 = """
我需要一盏漂亮的卧室灯，这款灯还带有额外的储物空间，价格也不算太高。
我很快就收到了它，只用了2天的时间。在运输过程中，灯的绳子断了，但是公司很高兴地寄来了一个新的。
几天后就收到了。组装很容易。然后我发现有一个零件缺失，于是我联系了他们的客服，他们很快就给我寄来了缺失的零件！
对我来说，这是一家非常关心客户和产品的优秀公司。
"""

# 一款电动牙刷的评论
review_3 = """
我的牙科卫生师推荐我使用电动牙刷，这就是我购买它的原因。
到目前为止，电池寿命似乎相当令人印象深刻。在最初充电并在第一周将充电器插头插入以对电池进行调节后，我已经拔掉了充电器，并在过去的3周中每天两次刷牙，都是在同一次充电的情况下完成的。
但是牙刷头太小了。我见过比这个更大的婴儿牙刷。我希望牙刷头更大，有不同长度的刷毛，以更好地清洁牙齿之间的区域，因为这个牙刷不能做到。
总的来说，如果你能在50美元左右购买到这个牙刷，那么这是一个不错的选择。制造商的替换刷头相当昂贵，但你可以购买价格更合理的通用刷头。这个牙刷让我感觉每天都去了牙医。我的牙齿感觉非常干净！
"""

# 一个搅拌机的评论
review_4 = """
所以，他们在11月份的季节性促销中仍然以约49美元的价格销售17件套装，折扣约为一半，但由于某种原因（称其为价格欺诈），到了12月第二周，所有价格都上涨了，同样的套装价格从70美元到89美元不等。
11件套装的价格也比之前的29美元上涨了约10美元。所以看起来还不错，但如果你看底座，刀锁定的部分看起来不如几年前的早期版本那么好，但我打算对它非常温柔（例如，我会先在搅拌机中碾碎像豆子、冰块、米饭等硬物，然后将它们粉碎成我想要的份量，然后切换到打蛋器刀片制作更细的面粉，制作冰沙时先使用交叉切割刀片，然后使用平刀片使它们更细/不那么浆状）。
制作冰沙时的一个特别提示是，将要使用的水果和蔬菜切碎并冷冻（如果使用菠菜-轻轻炖软菠菜，然后冷冻，直到使用时-如果制作冰糕，使用小到中型食品加工机），这样你就可以避免添加太多冰块，如果需要的话，当你制作你的冰沙时。大约一年后，电机发出奇怪的声音。我打电话给客户服务，但保修已经过期了，所以我不得不再买一个。
FYI：这些产品的整体质量已经下降了，所以他们有点依靠品牌认可和消费者忠诚度来维持销售。我在大约两天内收到了它。
"""



reviews = [review_1,review_2,review_3,review_4]

for i in range(len(reviews)):
     prompt = f"""
     你的任务是从电子商务网站上的产品评论中生成一个简短的摘要。

     把一篇电子商务网站上的产品评论简要总结在20个词以内。

     评论: ```{reviews[i]}```
     """
     response = get_completion(prompt)
     print(i, response,"\n")


# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<

# 0 超可爱的熊猫公仔，有点小，快递提前一天到。
# 1 漂亮的卧室灯，带储物空间，运输过程中绳子断了，但公司寄来新的，客服很好。
# 2 电动牙刷电池寿命长，但刷头太小，需要改进。价格合理，让牙齿感觉非常干净。
# 3 价格欺诈，质量下降，需谨慎购买。
````

## 5 文本推理(Inferring)

在传统的机器学习中,如果要做情感识别这类任务,通常需要收集数据集,训练模型,调参,评估模型,再调参,再评估,直到模型达到预期的效果.而在 LLM 中,只需要给出一个简单的例子,就可以让模型自动推断出规律,并完成任务.

### 5.1 情感识别

````python
doc = """
《七步诗》
作者：曹植

煮豆燃豆萁，豆在釜中泣。
本是同根生，相煎何太急？
"""

# 情感分析
prompt = f"""
以下用三个反引号分隔的古诗的情感是什么？

古诗：```{doc}```
"""

response = get_completion(prompt)
print(response)

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 这首古诗表达了作者对于同胞相互残杀的悲愤和不解。
````

#### 5.1.1 情感分类

我们可以要求 LLM 给出更加简洁的答案,方便以后处理

````python
# 情感分析
prompt = f"""
以下用三个反引号分隔的古诗的情感是什么？

用一个单词回答: [正面] 或 [负面]

古诗：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 负面
````

#### 5.1.2 情感类型

我们也可以识别出情感的类型

````python
# 情感分析
prompt = f"""
以下用三个反引号分隔的古诗的情感是什么？

包含不超过5个情感类型,将答案格式化为逗号分隔的单词列表

古诗：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 悲哀,愤怒,无奈
````

#### 5.1.3 愤怒识别

````python
prompt = f"""
以下古诗的作者是否表达了愤怒? 古诗三个反引号分隔.

给出是或否的答案

古诗：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 是
````

如果是使用常规的监督学习,上述功能不可能在几分钟内实现.

### 5.2 信息提取

信息抽取是自然语言处理（NLP）的一部分，在下面的任务中，我们要从古诗中抽取作者,主题等信息.

当我们对大量数据做处理时,这个功能就显得尤为重要.

````python
prompt = f"""

从古诗识别以下项目:
- 古诗的标题
- 古诗的作者
- 古诗的中心思想

古诗用三个反引号分隔.

将你的返回格式化以"标题","作者","主题"为key的JOSN对象
如果信息不存在,请使用"null"代替
答案尽可能简短


古诗：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# {
#   "标题": "七步诗",
#   "作者": "曹植",
#   "主题": "同根生，相煎何太急"
# }
````

### 5.3 多任务处理

在上面的例子中我们写了很多个 prompt 来实现不同功能,我们完全可以用一个 prompt 来实现所有功能.

````python
prompt = f"""

从古诗识别以下项目:
- 古诗的标题
- 古诗的作者
- 古诗的中心思想
- 是否表达了愤怒?(是或否)

古诗用三个反引号分隔.

将你的返回格式化以"标题","作者","主题","愤怒"为key的JOSN对象
如果信息不存在,请使用"null"代替
将愤怒的值格式化为布尔值

答案尽可能简短


古诗：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# {
#   "标题": "七步诗",
#   "作者": "曹植",
#   "主题": "同根生的豆子被煮熟，表达了人与人之间的互相伤害和矛盾",
#   "愤怒": false
# }
````

### 5.4 主题推断

在长文本中我们可以使用 LLM 推断文本主题,我们来随便找一段新闻

```python
doc = """
造势近一个月的阿根廷中国行进入最后的高潮。北京时间6月15日晚，顶着世界杯夺冠的光环，阿根廷队在队长梅西的带领下，与澳大利亚进行的国际友谊赛在北京工人体育场拉开序幕。

据了解，这是足球巨星梅西的第八次中国行，不少球迷从各地来到北京，身着10号球衣表达对偶像的喜爱与支持。下午6时许，北京工人体育馆附近已是10号球衣的海洋！3岁半小球迷高喊口号：梅西梅西，梅西第一。

6月15日晚，北京新工人体育场，2023国际足球邀请赛开场仅81秒，梅西远射破门。最终，阿根廷队2-0完胜澳大利亚队。

当比赛终场哨声响起，整个“新工体”爆发出了雷鸣般的掌声。这热烈的欢呼不仅送给获胜的阿根廷队，也送给陪伴无数球迷走过青春岁月的球王梅西。

“感谢中国球迷对我从未更改的爱，我们很高兴来到这里。”

当第八次中国行画上句号，梅西也将前往美国迈阿密踢球：“在取得了所有成就，终于夺得了我非常渴望的世界杯冠军之后，我也想追求其它的事，以及内心的平静。”
"""
```

#### 5.4.1 主题推断

````python
prompt = f"""

确定以下给定文本中讨论的五个主题。

每个主题用1-2个单词概括。

输出时用逗号分割每个主题。


给定文本：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 足球比赛, 梅西, 中国行, 球迷, 世界杯
````

#### 5.4.2 识别给定的主题

````python
prompt = f"""

判断主题列表中的每一项是否是给定文本中的一个主题，

每个主题答案用 0 或 1表示，并以键值对形式给出。

主题列表：比赛, 梅西

给定文本：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# {
#   "比赛": 1,
#   "梅西": 1
# }
````

在机器学习中这称为 Zero-Shot ：没有给模型任何有标注的训练数据，仅凭 prompt，它就能确定新闻文章涵盖了哪些主题。

这样如果我们想要一个新闻提醒系统,我们在上面脚本基础上很快就能实现.

```javaScript
// js脚本
if(response['梅西']=== 1){
    alert('有关于梅西的新闻出现了')
}
```

## 6.文本转换(Transforming)

LLM 非常擅长将输入转换成不同的格式，例如多语言本翻译、语法纠正、语气调整、格式转换等。以前可能要写一堆正则表达式，非常痛苦,现在我们只需要写一个 prompt 就能实现.

### 6.1 文本翻译

#### 6.1.1 语言翻译

````python
prompt = f"""
将以下中文翻译成西班牙语:
```上云就上阿里云```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# "Sube a la nube con Alibaba Cloud"
````

### 6.1.2 识别语种

````python

prompt = f"""
请告诉我以下文本是什么语种:
```shang yun jiu shang ali yun```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 这是中文
````

### 6.1.3 多语种翻译

````python
prompt = f"""
请将以下文本分别翻译成英语、法语和日语:
```上云就上阿里云```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# English: Go to the cloud, go to Alibaba Cloud.
# French: Allez dans le cloud, allez sur Alibaba Cloud.
# Japanese: クラウドに行くなら、Alibaba Cloudに行きましょう。
````

### 6.1.4 通用翻译器

当交流用户同时来自多个不同的国家,使用不同语言时,我们可以利用大模型制作一个通用翻译器.

````python
input = input("输入任何语言: ")

prompt = f"""
请将以下文本分别翻译成中文、英语、法语和日语,并写成:
中文翻译: aaa,
英语翻译: xxx,
法语翻译: yyy,
日语翻译: zzz
的格式

```{input}```
"""

response = get_completion(prompt)
print(response)
````

结果:
![通用翻译器](https://xrtech.oss-cn-shanghai.aliyuncs.com/uPic/2023-06/e7I0Nu.png)

### 6.2 语气修正

不同的书写场景下我们往往需要不同的语气,例如写邮件时我们需要正式的语气,而写微博时我们需要轻松的语气.我们可以利用大模型制作一个语气修正器.

````python

prompt = f"""
请将以下文本转换成正式商务邮件语气:
```嗨,小老弟,你好吗?我是你的老朋友,今天天气不错,我们一起去打球吧!```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 尊敬的先生/女士，

# 您好！我是您的老朋友，希望您一切都好。今天的天气非常适合户外运动，不知道您是
# 否有兴趣和我一起去打球呢？如果方便的话，
# 请告诉我您的时间和地点，我们可以一起享受运动的乐趣。

# 谢谢！
# 此致
# 敬礼
# XXX
````

### 6.3 文本格式转换

ChatGPT 非常擅长将文本转换成不同的格式,例如将文本转换成标题、列表、代码等.比如我们可以把下面的 JSON 转化为 markdown Table 格式

```python
data_json = { "学生名单" :[
    {"name":"李白", "email":"libai@qq.com"},
    {"name":"杜甫", "email":"dufu@qq.com"},
    {"name":"王维", "email":"wangwei@qq.com"}
]}

prompt = f"""
将以下Python字典从JSON转换为Markdown Table格式，保留表格标题和列名：{data_json}
"""
```

| 学生名单 | name | email          |
| -------- | ---- | -------------- |
|          | 李白 | libai@qq.com   |
|          | 杜甫 | dufu@qq.com    |
|          | 王维 | wangwei@qq.com |

### 6.4 语法纠正

拼写及语法的检查与纠正是一个十分常见的需求，特别是使用非母语使，例如发表英文论文时。

下面句子中，部分存在拼写或语法问题。循环遍历每个句子，要求模型校对文本，如果正确则输出“未发现错误”，如果错误则输出纠正后的文本。

````python

# 语言矫正
text = [
  "The girl with the black and white puppies have a ball.",  # The girl has a ball.
  "Yolanda has her notebook.", # ok
  "Its going to be a long day. Does the car need it’s oil changed?",  # Homonyms
  "Their goes my freedom. There going to bring they’re suitcases.",  # Homonyms
  "Your going to need you’re notebook.",  # Homonyms
  "That medicine effects my ability to sleep. Have you heard of the butterfly affect?", # Homonyms
  "This phrase is to cherck chatGPT for spelling abilitty"  # spelling
]

for i in range(len(text)):
    prompt = f"""请校对并更正以下文本，无需输出原始文本，只输出纠正后的文本，且保持语种不变。
    如没有发现任何错误，请说“未发现错误”。

    例如：
    输入：I are happy.
    输出：I am happy.
    ```{text[i]}```"""
    response = get_completion(prompt)
    print(i, response)


# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
0 The girl with the black and white puppies has a ball.
# 1 未发现错误。
# 2 It's going to be a long day. Does the car need its oil changed?
# 3 Their goes my freedom. They're going to bring their suitcases.
# 4 You're going to need your notebook.
# 5 That medicine affects my ability to sleep. Have you heard of the butterfly effect?
# 6 This phrase is to check chatGPT for spelling ability.
````
