---
external: false
title: 【大模型】 Prompt Engineering 02
description: 2023 年,chatGPT 如春雷乍响,开启了人工智能的新纪元. 我也开启了我的第一课
date: 2023-06-18 00:17:00
---

> 本文主要观点来自 [ChatGPT Prompt Engineering 吴恩达 Prompt](https://learn.deeplearning.ai/)

本文分为上下两篇,上篇:[【大模型】 Prompt Engineering 01](/blog/prompt-engineering-01/)

## 3. 优化迭代指令(Iterative)

使用 LLM 创建应用时很难一蹴而就,需要多次迭代. 那么一个好的迭代流程对于改进 Prompt 是非常重要的.

提出想法 → 编写代码 → 分析结果 → 重复

### 3.1 环境配置

我们复用上一章的环境配置和基本代码.担心你懒得点回去,我把环境配置内容再贴一遍

1. 安装 python (推荐使用 anaconda )

2. 安装依赖

```bash
pip install openai
pip install python-dotenv
```

3. 新建一个文件夹,在文件夹里创建 .env 文件,并在其中添加你的 openai API key

```bash
OPENAI_API_KEY='sk-XXXXX'
```

4. 创建一个 python 文件,并在其中添加如下代码

```python
import openai
import os
from dotenv import load_dotenv,find_dotenv

_ = load_dotenv(find_dotenv()) # read local .env file

openai.api_key = os.getenv("OPENAI_API_KEY")

def get_completion(prompt, model = "gpt-3.5-turbo"):
  messages = [{"role":"user","content":prompt}]
  response = openai.ChatCompletion.create(
    model=model,
    messages=messages,
    temperature=0,
  )
  return response.choices[0].message["content"]
```

### 3.2 任务目标: 根据说明书生产营销文案

我们的任务是根据说明书生产营销文案,首先简单写一个 prompt 看看效果

````python

# 产品说明书
doc = """
概述

美丽的中世纪风格办公家具系列的一部分，包括文件柜、办公桌、书柜、会议桌等。
     多种外壳颜色和底座涂层可选。
     可选塑料前后靠背装饰（SWC-100）或 10 种面料和 6 种皮革的全面装饰（SWC-110）。
     底座涂层选项为：不锈钢、哑光黑色、光泽白色或铬。
     椅子可带或不带扶手。
     适用于家庭或商业场所。
     符合合同使用资格。

结构

五个轮子的塑料涂层铝底座。
     气动椅子调节，方便升降。

尺寸

宽度 53 厘米|20.87 英寸
     深度 51 厘米|20.08 英寸
     高度 80 厘米|31.50 英寸
     座椅高度 44 厘米|17.32 英寸
     座椅深度 41 厘米|16.14 英寸

选项

软地板或硬地板滚轮选项。
     两种座椅泡沫密度可选：中等（1.8 磅/立方英尺）或高（2.8 磅/立方英尺）。
     无扶手或 8 个位置 PU 扶手。

材料
外壳底座滑动件

改性尼龙 PA6/PA66 涂层的铸铝。
     外壳厚度：10 毫米。
     座椅
    HD36 泡沫

原产国

意大利
"""

# 生成营销文案
prompt = f"""
你的任务是帮助营销团队基于技术说明书创建一个产品的营销描述。

根据```标记的技术说明书中提供的信息，编写一个产品描述。

技术说明: ```{doc}```
"""

response = get_completion(prompt)
print(response)

````

最后结果:
![结果](https://xrtech.oss-cn-shanghai.aliyuncs.com/uPic/2023-06/aXR871.png)

看起来还不错,接下来我们对 prompt 做一些优化

### 3.2.1 优化 1: 文本太长

**解决方法**: 对他返回的文本长度进行限制

````python
# 优化后的 Prompt，要求生成描述不多于 50 词
prompt = f"""
您的任务是帮助营销团队基于技术说明书创建一个产品的零售网站描述。

根据```标记的技术说明书中提供的信息，编写一个产品描述。

使用最多50个词。

技术规格：```{doc}```
"""


# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 这款美丽的中世纪风格办公家具系列包括文件柜、办公桌、书柜、会议桌等。可选多种外壳颜色和底座涂层，底座涂层选项为不锈钢、哑光黑色、光泽白色或铬。椅子可带或不带扶手，适用于家庭或商业场所。
````

LLM 在遵循非常精确的字数限制方面表现得还可以，但并不那么出色，有时它会输出 60 或 65 个单词的内容，但这还算是合理的，这原因是 LLM 解释文本使用一种叫做分词器的技术.

### 3.2.2 优化 2: 关注点不对

我们的目标用户是家具零售商,他们更加关心产品的技术细节和材料.
**解决方法**: 要求它专注于与目标受众相关的方面。

````python
prompt = f"""
您的任务是帮助营销团队基于技术说明书创建一个产品的零售网站描述。

根据```标记的技术说明书中提供的信息，编写一个产品描述。

该描述面向家具零售商，因此应具有技术性质，并侧重于产品的材料构造。

在描述末尾，包括技术规格中每个7个字符的产品ID。

使用最多50个词。

技术规格：```{doc}```
"""

# >>>>>>>>>>>>>>>>>>>结果<<<<<<<<<<<<<<<<<<<<<<
# 这款中世纪风格的办公家具系列包括文件柜、办公桌、书柜和会议桌等。可选多种外壳颜色和底座涂层，底座涂层选项为不锈钢、哑光黑色、光泽白色或铬。椅子可带或不带扶手，适用于家庭或商业场所。座椅高度44厘米，座椅深度41厘米。产品ID：SWC-100/SWC-110。
````

### 3.2.3 优化 3: 结构化的输出

上面就是一个简单的 prompt 迭代优化案例,但我们还可以要求模型输出结构化的文本,比如我们可以要求模型输出成 html 格式,这样就可以直接在网页中显示.

````python
prompt = f"""
您的任务是帮助营销团队基于技术说明书创建一个产品的零售网站描述。

根据```标记的技术说明书中提供的信息，编写一个产品描述。

该描述面向家具零售商，因此应具有技术性质，并侧重于产品的材料构造。

在描述末尾，包括技术规格中每个7个字符的产品ID。

在描述之后，包括一个表格，提供产品的尺寸。表格应该有两列。第一列包括尺寸的名称。第二列只包括英寸的测量值。

给表格命名为“产品尺寸”。

将所有内容格式化为可用于网站的HTML格式。将描述放在<div>元素中。

技术规格：```{doc}```
"""

````

结果:
{% codepen url="https://codepen.io/wuriqilang/pen/qBQZxgR" slug="qBQZxgR" title="大模型结构化输出" /%}

## 4 文本摘要(Summarizing)

世界上有太多的文本信息，几乎没有人能够拥有足够的时间去。但 LLM 在文本概括任务上展现了强大的水准.

![人生苦短](https://xrtech.oss-cn-shanghai.aliyuncs.com/uPic/2023-06/4AjAsN.jpg)

### 4.1 单文本概括

我们举一个电商的例子,对于电商平台来说,用户的评论是非常重要的,但是用户的评论往往是非常长的,我们可以使用 LLM 来对用户的评论进行概括,这样就可以在用户评论的时候,直接显示概括的内容,而不是显示全部的评论.

```python

```
